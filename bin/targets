#!/bin/bash
preparar() {
  awk '{print "N" OFS $0}' "$@"
}

datos() {
  bin/inputs
}

prefijo() {
  sed -r \
    -e 's#^data/#results/001/#g' \
    -e 's#\.txt$##g'
}

genes() {
   ARCHIVO="$1"
   bin/genes "$ARCHIVO"
}

revisar_redes() {
  bin/inputs \
  | bin/input2check \
  | xargs -l mk
}

main() {
  # revisar las redes con mk
  revisar_redes >&2

  for f in `datos`; do
    # s√≥lo agregar a la cola si pasaron las pruebas
    test -e `echo $f | bin/input2check` || continue

    # combinar las redes con cada uno de sus genes
    join \
	<(echo "$f" | prefijo | preparar) \
	<(bin/genes "$f" | sort -V | cat -n | preparar) \
    | awk '{print $2 "." $3 "." $4 ".adj"}'
  done
}

main "$@"
